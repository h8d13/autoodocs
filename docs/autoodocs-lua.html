<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>autoodocs.lua</title>
    <link rel="stylesheet" type="text/css" href="default.css" />
    <script>document.write('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/'+(matchMedia('(prefers-color-scheme:dark)').matches?'github-dark':'github')+'.min.css"/>')</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
<div class="container">
<nav class="sidebar">
<h2>Contents <a href="index.html" class="sidebar-home" title="Home">⌂</a></h2>
<ul id="toc">
<li><a href="#chk">Checks</a></li>
<li><a href="#def">Defines</a></li>
<li class="toc-sub"><a href="#def-1">1. General docs</a></li>
<li class="toc-sub"><a href="#def-2">2. Localize functions and load libraries</a></li>
<li class="toc-sub"><a href="#def-3">3. Parse CLI args with defaults</a></li>
<li class="toc-sub"><a href="#def-4">4. Global state for collected records, warnings, and line count</a></li>
<li><a href="#run">Runners</a></li>
<li class="toc-sub"><a href="#run-1">1. Write file if content changed</a></li>
<li class="toc-sub"><a href="#run-2">2. Main function</a></li>
<li class="toc-sub"><a href="#run-3">3. Entry point</a></li>
<li><a href="#err">Errors</a></li>
</ul>
</nav>
<main class="content">

<h1>autoodocs.lua</h1>

<p><code>~/Desktop/autoodocs/autoodocs.lua</code></p>

<p>Documentation generator that extracts tagged comments from source files</p>

<p>This library is built to generate docs from source code.</p>

<p>It is also made for AI to auto document it's code in a structured human readable format.</p>

<p>This creates a pleasing flow to work with for docs/ pages.</p>

<h2><a id="chk"></a>Checks</h2>

<h3><a id="chk-1"></a>1. <code>-s</code> outputs extra stats</h3>

<p><code>~/Desktop/autoodocs/autoodocs.lua:12</code></p>


<h2><a id="def"></a>Defines</h2>

<h3><a id="def-1"></a>1. General docs</h3>

<p><code>~/Desktop/autoodocs/autoodocs.lua:14</code></p>

<div class="callout callout-important">
    <div class="callout-title">IMPORTANT</div>
    <p>after the end of comment block</p>
</div>

<p>we define <code>:</code> then <code>n</code> the amount of subject</p>

<p>and optionally a callout:</p>

<p><code>!n</code> NOTE</p>

<p><code>!t</code> TIP</p>

<p><code>!w</code> WARN</p>

<p><code>!c</code> CAUTION</p>

<pre><code class="language-lua">print('luadoc is awesome')
    -- STANDALONES (Place anywhere)
        -- @gen General     -&gt; File description
        ---- plain text at top, no section header
        -- @chk Check       -&gt; Early checks
        ---- guard the entry, bail/handle early if preconditions fail
        -- @def Define      -&gt; Gives instructions to
        ---- define the state/config the rest depends on
        -- @run Run         -&gt; Use the instructions
        ---- do the actual work using those definitions
        -- @err Error       -&gt; Handle what went wrong
        ---- handle errors with more definitions
    -- Descriptions (Used inside another of above)
        -- @src Source      -&gt; Points path:line nbr
        ---- mention line nr auto resolve anchor
        -- @ref Receipt     -&gt; External links
        ---- renders clickable arrow link in quote
</code></pre>

<h3><a id="def-2"></a>2. Localize functions and load libraries</h3>

<p><code>~/Desktop/autoodocs/autoodocs.lua:42</code></p>

<pre><code class="language-lua">local match  = string.match
local gsub   = string.gsub
local sub    = string.sub
local fmt    = string.format
local open   = io.open

-- Set package path relative to script location
local script_dir = arg[0]:match("^(.-)[^/]*$") or "./"
package.path = script_dir .. "?.lua;" .. script_dir .. "?/init.lua;" .. package.path
</code></pre>

<h3><a id="def-3"></a>3. Parse CLI args with defaults</h3>

<p><code>~/Desktop/autoodocs/autoodocs.lua:57</code></p>

<p>strip trailing slash, resolve absolute path via <code>/proc/self/environ</code></p>

<blockquote>
    <p><code>US</code> separates multi-line text within record fields</p>
    
    <p><code>-c</code> enables subject count validation, <code>-r</code> sets repo URL</p>
</blockquote>

<pre><code class="language-lua">local SCAN_DIR = arg[1] or "."
local OUT_DIR  = arg[2] or "docs"
local STATS, CHECK, REPO = false, false, nil
for i = 3, #arg do
    if arg[i] == "-s" then STATS = true
    elseif arg[i] == "-c" then CHECK = true
    elseif arg[i] == "-r" and arg[i+1] then REPO = arg[i+1]
    end
end
SCAN_DIR = gsub(SCAN_DIR, "/$", "")
if sub(SCAN_DIR, 1, 1) ~= "/" then
    local ef = open("/proc/self/environ", "rb")
    local cwd = ef and match(ef:read("*a"), "PWD=([^%z]+)")
    if ef then ef:close() end
    SCAN_DIR = (SCAN_DIR == ".") and cwd or cwd .. "/" .. SCAN_DIR
end
local HOME = match(SCAN_DIR, "^(/[^/]+/[^/]+)")
local US = "\031"
</code></pre>

<h3><a id="def-4"></a>4. Global state for collected records, warnings, and line count</h3>

<p><code>~/Desktop/autoodocs/autoodocs.lua:80</code></p>

<p>see <em>↳ <a href="parser-lua.html#chk-16">lib/parser.lua:195</a></em> for file processing</p>

<pre><code class="language-lua">local records = {}
local warnings = {}
local total_input = 0
</code></pre>

<h2><a id="run"></a>Runners</h2>

<h3><a id="run-1"></a>1. Write file if content changed</h3>

<p><code>~/Desktop/autoodocs/autoodocs.lua:86</code></p>


<h3><a id="run-2"></a>2. Main function</h3>

<p><code>~/Desktop/autoodocs/autoodocs.lua:102</code></p>

<pre><code class="language-lua">local function main()
</code></pre>

<p><a id="run-2-1"></a><strong>2.1 ~/Desktop/autoodocs/autoodocs.lua:104</strong>
<em>↳ <a href="#run-2">@run 2.</a></em></p>

<p>Create output directory</p>


<p><a id="run-2-2"></a><strong>2.2 ~/Desktop/autoodocs/autoodocs.lua:107</strong>
<em>↳ <a href="#run-2">@run 2.</a></em></p>

<p>Discover files containing documentation tags</p>

<blockquote>
    <p>respect <code>.gitignore</code> patterns via <code>grep --exclude-from</code></p>
</blockquote>

<pre><code class="language-lua">    local gi = ""
    local gf = open(SCAN_DIR .. "/.gitignore", "r")
    if gf then
        gf:close()
        gi = "--exclude-from=" .. utils.shell_quote(SCAN_DIR .. "/.gitignore")
    end

    local cmd = fmt(
        'grep -rl -I --exclude-dir=".*" --exclude-dir=%s --exclude="*.html" --exclude="[Rr][Ee][Aa][Dd][Mm][Ee].[Mm][Dd]" %s -e "@def" -e "@chk" -e "@run" -e "@err" %s 2&gt;/dev/null',
        match(OUT_DIR, "([^/]+)$") or OUT_DIR, gi, utils.shell_quote(SCAN_DIR)
    )
    local pipe = io.popen(cmd)
    local files = {}
    for line in pipe:lines() do
        files[#files + 1] = line
    end
    pipe:close()
</code></pre>

<p><a id="run-2-3"></a><strong>2.3 ~/Desktop/autoodocs/autoodocs.lua:133</strong>
<em>↳ <a href="#run-2">@run 2.</a></em></p>

<p>Process all discovered files into intermediate <code>records</code></p>

<pre><code class="language-lua">    for _, fp in ipairs(files) do
        total_input = total_input + parser.process_file(fp, records, HOME, US, CHECK and warnings)
    end
</code></pre>

<p><a id="run-2-4"></a><strong>2.4 ~/Desktop/autoodocs/autoodocs.lua:144</strong>
<em>↳ <a href="#run-2">@run 2.</a></em></p>

<p>Group and index records by file</p>

<pre><code class="language-lua">    local by_file, file_order = render.group_records(records)
</code></pre>

<p><a id="run-2-5"></a><strong>2.5 ~/Desktop/autoodocs/autoodocs.lua:147</strong>
<em>↳ <a href="#run-2">@run 2.</a></em></p>

<p>Write index page</p>


<p><a id="run-2-6"></a><strong>2.6 ~/Desktop/autoodocs/autoodocs.lua:154</strong>
<em>↳ <a href="#run-2">@run 2.</a></em></p>

<p>Write individual file pages</p>


<p><a id="run-2-7"></a><strong>2.7 ~/Desktop/autoodocs/autoodocs.lua:168</strong>
<em>↳ <a href="#run-2">@run 2.</a></em></p>

<p>Output subject count warnings if check mode enabled</p>

<pre><code class="language-lua">    if CHECK and #warnings &gt; 0 then
        io.stderr:write(fmt("autoodocs: %d subject count warnings:\n", #warnings))
        for _, w in ipairs(warnings) do
            io.stderr:write(fmt("  %s:%s @%s:%d ends mid-block\n", w.file, w.line, w.tag, w.count))
        end
    end
</code></pre>

<p><a id="run-2-8"></a><strong>2.8 ~/Desktop/autoodocs/autoodocs.lua:176</strong>
<em>↳ <a href="#run-2">@run 2.</a></em></p>

<p>Output stats if requested</p>

<pre><code class="language-lua">    if STATS then
        os.execute(fmt("awk -f " .. script_dir .. "stats.awk %s/*.md", OUT_DIR))
    end
end
</code></pre>

<h3><a id="run-3"></a>3. Entry point</h3>

<p><code>~/Desktop/autoodocs/autoodocs.lua:182</code></p>

<pre><code class="language-lua">main()
</code></pre>

<h2><a id="err"></a>Errors</h2>

<p><a id="err-1"></a><strong>1. ~/Desktop/autoodocs/autoodocs.lua:127</strong>
<em>↳ <a href="#run-2">@run 2.</a></em></p>

<p>No tagged files found</p>

<pre><code class="language-lua">    if #files == 0 then
        io.stderr:write(fmt("autoodocs: no tags found under %s\n", SCAN_DIR))
        return
    end
</code></pre>

<p><a id="err-2"></a><strong>2. ~/Desktop/autoodocs/autoodocs.lua:138</strong>
<em>↳ <a href="#run-2">@run 2.</a></em></p>

<p>No extractable documentation</p>

<pre><code class="language-lua">    if #records == 0 then
        io.stderr:write(fmt("autoodocs: tags found but no extractable docs under %s\n", SCAN_DIR))
        return
    end
</code></pre>


<div class="build-timestamp">Generated: 2026-02-15 23:10</div>
</main>
</div>
<script>
hljs.highlightAll();
// Hide home icon on index page
if (location.pathname.endsWith('index.html') || location.pathname.endsWith('/')) {
    var home = document.querySelector('.sidebar-home');
    if (home) home.style.display = 'none';
}
// Highlight active section on scroll
var links = document.querySelectorAll('.sidebar a');
var sections = document.querySelectorAll('.content h2, .content h3');
window.addEventListener('scroll', function() {
    var current = '';
    sections.forEach(function(section) {
        var anchor = section.querySelector('a');
        if (anchor && window.scrollY >= section.offsetTop - 100) {
            current = anchor.id;
        }
    });
    links.forEach(function(link) {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + current) {
            link.classList.add('active');
        }
    });
});
</script>
</body></html>