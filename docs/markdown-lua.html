<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>markdown.lua</title>
    <link rel="stylesheet" type="text/css" href="default.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
<div class="container">
<nav class="sidebar">
<a href="index.html" class="sidebar-home">← Index</a>
<h2>Contents</h2>
<ul id="toc">
<li><a href="#chk">Checks</a></li>
<li class="toc-sub"><a href="#chk-1">Returns true if line is a ruler of repeated characters</a></li>
<li class="toc-sub"><a href="#chk-2">Classify block-level formatting in a line</a></li>
<li><a href="#def">Defines</a></li>
<li class="toc-sub"><a href="#def-1">Forward declarations for mutually recursive functions</a></li>
<li class="toc-sub"><a href="#def-2">Map values in table through function f</a></li>
<li class="toc-sub"><a href="#def-3">Identity function, useful as a placeholder</a></li>
<li class="toc-sub"><a href="#def-4">Functional style ternary (no short circuit)</a></li>
<li class="toc-sub"><a href="#def-5">Hash data into unique alphanumeric strings</a></li>
<li class="toc-sub"><a href="#def-6">Protect document parts from modification</a></li>
<li class="toc-sub"><a href="#def-7">Characters with special markdown meaning needing escape</a></li>
<li><a href="#run">Runners</a></li>
<li class="toc-sub"><a href="#run-1">Split text into array of lines by separator</a></li>
<li class="toc-sub"><a href="#run-2">Block-level text transforms working with arrays of lines</a></li>
<li class="toc-sub"><a href="#run-3">Convert normal + ruler lines to header entries</a></li>
<li class="toc-sub"><a href="#run-4">Convert list blocks to protected HTML</a></li>
<li class="toc-sub"><a href="#run-5">Convert blockquote markers with GitHub callout support</a></li>
<li class="toc-sub"><a href="#run-6">Convert fenced code blocks with language hints</a></li>
<li class="toc-sub"><a href="#run-7">Span-level text transforms for inline formatting</a></li>
<li class="toc-sub"><a href="#run-8">Normalize line endings, tabs, and whitespace</a></li>
<li class="toc-sub"><a href="#run-9">Main markdown processing pipeline</a></li>
<li class="toc-sub"><a href="#run-10">CLI handler with HTML wrapping and TOC generation</a></li>
<li><a href="#err">Errors</a></li>
</ul>
</nav>
<main class="content">

<h1>markdown.lua</h1>

<p><code>~/Desktop/autoodocs/markdown.lua</code></p>

<p>Markdown to HTML converter with GitHub-style callouts and TOC generation</p>

<p>Mostly stolen from https://github.com/speedata/luamarkdown with minor modifications for our parsers.</p>

<h2><a id="chk"></a>Checks</h2>

<h3><a id="chk-1"></a>Returns true if line is a ruler of repeated characters</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:388</code></p>

<p>The line must contain at least three char characters and contain only spaces and</p>

<blockquote>
    <p>char characters.</p>
</blockquote>

<pre><code class="language-lua">local function is_ruler_of(line, char)
    if not line:match("^[ %" .. char .. "]*$") then return false end
    if not line:match("%" .. char .. ".*%" .. char .. ".*%" .. char) then return false end
    return true
end

</code></pre>

<h3><a id="chk-2"></a>Classify block-level formatting in a line</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:397</code></p>


<h2><a id="def"></a>Defines</h2>

<h3><a id="def-1"></a>Forward declarations for mutually recursive functions</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:122</code></p>

<pre><code class="language-lua">local span_transform, encode_backslash_escapes, block_transform, blocks_to_html
</code></pre>

<h3><a id="def-2"></a>Map values in table through function f</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:129</code></p>

<pre><code class="language-lua">local function map(t, f)
    local out = {}
    for k,v in pairs(t) do out[k] = f(v,k) end
    return out
end
</code></pre>

<h3><a id="def-3"></a>Identity function, useful as a placeholder</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:136</code></p>

<pre><code class="language-lua">local function identity(text) return text end
</code></pre>

<h3><a id="def-4"></a>Functional style ternary (no short circuit)</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:139</code></p>

<pre><code class="language-lua">local function iff(t, a, b) if t then return a else return b end end
</code></pre>

<h3><a id="def-5"></a>Hash data into unique alphanumeric strings</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:253</code></p>

<div class="callout callout-note">
    <div class="callout-title">NOTE</div>
    <p>not cryptographic - used to protect parts from further processing</p>
</div>

<pre><code class="language-lua">local HASH = {
    -- Has the hash been inited.
    inited = false,

    -- The unique string prepended to all hash values. This is to ensure
    -- that hash values do not accidently coincide with an actual existing
    -- string in the document.
    identifier = "",

    -- Counter that counts up for each new hash instance.
    counter = 0,

    -- Hash table.
    table = {}
}
</code></pre>

<h3><a id="def-6"></a>Protect document parts from modification</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:305</code></p>

<div class="callout callout-note">
    <div class="callout-title">NOTE</div>
    <p>saved in table for later unprotection</p>
</div>

<pre><code class="language-lua">local PD = {
    -- Saved blocks that have been converted
    blocks = {},

    -- Block level tags that will be protected
    tags = {"p", "div", "h1", "h2", "h3", "h4", "h5", "h6", "blockquote",
    "pre", "table", "dl", "ol", "ul", "script", "noscript", "form", "fieldset",
    "iframe", "math", "ins", "del"}
}
</code></pre>

<h3><a id="def-7"></a>Characters with special markdown meaning needing escape</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:828</code></p>

<pre><code class="language-lua">escape_chars = "'\\`*_{}[]()&gt;#+-.!'"
escape_table = {}
</code></pre>

<h2><a id="run"></a>Runners</h2>

<h3><a id="run-1"></a>Split text into array of lines by separator</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:142</code></p>

<pre><code class="language-lua">local function split(text, sep)
    sep = sep or "\n"
    local lines = {}
    local pos = 1
    while true do
        local b,e = text:find(sep, pos)
        if not b then table.insert(lines, text:sub(pos)) break end
        table.insert(lines, text:sub(pos, b-1))
        pos = e + 1
    end
    return lines
end
</code></pre>

<h3><a id="run-2"></a>Block-level text transforms working with arrays of lines</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:386</code></p>


<h3><a id="run-3"></a>Convert normal + ruler lines to header entries</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:462</code></p>


<h3><a id="run-4"></a>Convert list blocks to protected HTML</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:480</code></p>


<h3><a id="run-5"></a>Convert blockquote markers with GitHub callout support</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:603</code></p>


<h3><a id="run-6"></a>Convert fenced code blocks with language hints</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:665</code></p>


<h3><a id="run-7"></a>Span-level text transforms for inline formatting</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:826</code></p>


<h3><a id="run-8"></a>Normalize line endings, tabs, and whitespace</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:1116</code></p>


<h3><a id="run-9"></a>Main markdown processing pipeline</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:1161</code></p>

<pre><code class="language-lua">local function markdown(text)
    init_hash(text)
    init_escape_table()

    text = cleanup(text)
    text = protect(text)
    text, link_database = strip_link_definitions(text)
    text = block_transform(text)
    text = unescape_special_chars(text)
    return text
</code></pre>

<h3><a id="run-10"></a>CLI handler with HTML wrapping and TOC generation</h3>

<p><code>~/Desktop/autoodocs/markdown.lua:1264</code></p>


<h2><a id="err"></a>Errors</h2>

<p><a id="err-1"></a><strong>1. ~/Desktop/autoodocs/markdown.lua:1271</strong>
<em>↳ <a href="#run-10">@run 10.</a></em></p>

<p>Header file not found</p>


<p><a id="err-1-1"></a><strong>1.1 ~/Desktop/autoodocs/markdown.lua:1299</strong>
<em>↳ <a href="#err-1">@err 1.</a></em></p>

<p>Stylesheet file not found for inline inclusion</p>


<p><a id="err-2"></a><strong>2. ~/Desktop/autoodocs/markdown.lua:1372</strong>
<em>↳ <a href="#run-10">@run 10.</a></em></p>

<p>Footer file not found</p>


<p><a id="err-3"></a><strong>3. ~/Desktop/autoodocs/markdown.lua:1435</strong>
<em>↳ <a href="#run-10">@run 10.</a></em></p>

<p>Test file not found</p>


<p><a id="err-4"></a><strong>4. ~/Desktop/autoodocs/markdown.lua:1445</strong>
<em>↳ <a href="#run-10">@run 10.</a></em></p>

<p>Input or output file cannot be opened</p>



</main>
</div>
<script>
hljs.highlightAll();
// Highlight active section on scroll
var links = document.querySelectorAll('.sidebar a');
var sections = document.querySelectorAll('.content h2, .content h3');
window.addEventListener('scroll', function() {
    var current = '';
    sections.forEach(function(section) {
        var anchor = section.querySelector('a');
        if (anchor && window.scrollY >= section.offsetTop - 100) {
            current = anchor.id;
        }
    });
    links.forEach(function(link) {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + current) {
            link.classList.add('active');
        }
    });
});
</script>
</body></html>